"use strict";angular.module("com.2fdevs.videogular.plugins.imaads",[]).directive("vgImaAds",["$timeout","VG_STATES","VG_EVENTS",function(a,b,c){return{restrict:"E",require:"^videogular",scope:{vgNetwork:"=",vgUnitPath:"=",vgCompanion:"=",vgCompanionSize:"=",vgAdTagUrl:"="},link:function(a,b,d,e){function f(a,b){var c;t=b[0],u=b[1],c=e.isFullScreen?google.ima.ViewMode.FULLSCREEN:google.ima.ViewMode.NORMAL,y&&y.resize(t,u,c)}function g(){z||(e.pause(),i(a.vgAdTagUrl),z=!0)}function h(){w.initialize()}function i(a){var b=new google.ima.AdsRequest,c=e.getSize();b.adTagUrl=a,b.linearAdSlotWidth=c.width,b.linearAdSlotHeight=c.height,b.nonLinearAdSlotWidth=c.width,b.nonLinearAdSlotHeight=c.height,x.requestAds(b)}function j(a){r(),y=a.getAdsManager(e.videoElement[0]),k(y)}function k(a){a.addEventListener(google.ima.AdEvent.Type.CONTENT_PAUSE_REQUESTED,l,!1,this),a.addEventListener(google.ima.AdEvent.Type.CONTENT_RESUME_REQUESTED,m,!1,this),a.addEventListener(google.ima.AdErrorEvent.Type.AD_ERROR,n,!1,this),a.addEventListener(google.ima.AdEvent.Type.ALL_ADS_COMPLETED,p,!1,this),a.addEventListener(google.ima.AdEvent.Type.COMPLETE,q,!1,this),a.init(t,u,google.ima.ViewMode.NORMAL),a.start()}function l(){r(),e.pause()}function m(){v||(e.play(),s())}function n(){y&&y.destroy(),s(),e.play()}function o(){v=!0,x.contentComplete()}function p(){s()}function q(){s()}function r(){b.css("display","block")}function s(){b.css("display","none")}var t,u,v=!1,w=new google.ima.AdDisplayContainer(b[0]),x=new google.ima.AdsLoader(w),y=null,z=!1;x.addEventListener(google.ima.AdsManagerLoadedEvent.Type.ADS_MANAGER_LOADED,j,!1,this),x.addEventListener(google.ima.AdErrorEvent.Type.AD_ERROR,n,!1,this),e.$on(c.ON_UPDATE_SIZE,f),e.$on(c.ON_PLAY,g),e.$on(c.ON_START_PLAYING,h),e.$on(c.ON_COMPLETE,o),a.vgCompanion&&googletag.cmd.push(function(){googletag.defineSlot("/"+a.vgNetwork+"/"+a.vgUnitPath,a.vgCompanionSize,a.vgCompanion).addService(googletag.companionAds()).addService(googletag.pubads()),googletag.companionAds().setRefreshUnfilledSlots(!0),googletag.pubads().enableVideoAds(),googletag.enableServices()})}}}]);