angular.module("com.2fdevs.videogular.plugins.imaads",[]).directive("vgImaAds",["$timeout","VG_STATES","VG_EVENTS",function(u,A,g){return{restrict:"E",require:"^videogular",scope:{vgNetwork:"=",vgUnitPath:"=",vgCompanion:"=",vgCompanionSize:"=",vgAdTagUrl:"="},link:function(e,l,u,b){function v(a){a.addEventListener(google.ima.AdEvent.Type.CONTENT_PAUSE_REQUESTED,w,!1,this);a.addEventListener(google.ima.AdEvent.Type.CONTENT_RESUME_REQUESTED,x,!1,this);a.addEventListener(google.ima.AdErrorEvent.Type.AD_ERROR,
p,!1,this);a.addEventListener(google.ima.AdEvent.Type.ALL_ADS_COMPLETED,y,!1,this);a.addEventListener(google.ima.AdEvent.Type.COMPLETE,z,!1,this);a.init(m,n,google.ima.ViewMode.NORMAL);a.start()}function w(a){q();b.pause()}function x(a){r||(b.play(),h())}function p(a){f&&f.destroy();h();b.play()}function y(){h()}function z(){h()}function q(){l.css("display","block")}function h(){l.css("display","none")}var r=!1,s=new google.ima.AdDisplayContainer(l[0]),k=new google.ima.AdsLoader(s),f=null,t=!1,m,
n;k.addEventListener(google.ima.AdsManagerLoadedEvent.Type.ADS_MANAGER_LOADED,function(a){q();f=a.getAdsManager(b.videoElement[0]);v(f)},!1,this);k.addEventListener(google.ima.AdErrorEvent.Type.AD_ERROR,p,!1,this);b.$on(g.ON_UPDATE_SIZE,function(a,c){var d;m=c[0];n=c[1];d=b.isFullScreen?google.ima.ViewMode.FULLSCREEN:google.ima.ViewMode.NORMAL;f&&f.resize(m,n,d)});b.$on(g.ON_PLAY,function(){if(!t){b.pause();var a=e.vgAdTagUrl,c=new google.ima.AdsRequest,d=b.getSize();c.adTagUrl=a;c.linearAdSlotWidth=
d.width;c.linearAdSlotHeight=d.height;c.nonLinearAdSlotWidth=d.width;c.nonLinearAdSlotHeight=d.height;k.requestAds(c);t=!0}});b.$on(g.ON_START_PLAYING,function(){s.initialize()});b.$on(g.ON_COMPLETE,function(){r=!0;k.contentComplete()});e.vgCompanion&&googletag.cmd.push(function(){googletag.defineSlot("/"+e.vgNetwork+"/"+e.vgUnitPath,e.vgCompanionSize,e.vgCompanion).addService(googletag.companionAds()).addService(googletag.pubads());googletag.companionAds().setRefreshUnfilledSlots(!0);googletag.pubads().enableVideoAds();
googletag.enableServices()})}}}]);